let
    // Base from balances only (already includes Monthly_Checking and Monthly_Savings)
    Expanded = BalancesTable,

    // Inputs for Platform fees, membership, interchange share, SG&A
    JoinedPlatformInterchangeRate = Table.NestedJoin(Expanded, {"Month"},
        Table.SelectRows(InterpolatedInputs, each [InputType] = "PlatformInterchangeRate"), {"Month"},
        "PlatformInterchangeRateData", JoinKind.LeftOuter),
    ExpandedPlatformInterchangeRate = Table.ExpandTableColumn(JoinedPlatformInterchangeRate, "PlatformInterchangeRateData", {"Value"}, {"PlatformInterchangeRate"}),
    // Default missing platform interchange rate to 0
    FilledInterchange = Table.ReplaceValue(ExpandedPlatformInterchangeRate, null, 0, Replacer.ReplaceValue, {"PlatformInterchangeRate"}),

    JoinedMembershipFee = Table.NestedJoin(FilledInterchange, {"Month"},
        Table.SelectRows(InterpolatedInputs, each [InputType] = "MembershipFeePerActive"), {"Month"},
        "MembershipFeeData", JoinKind.LeftOuter),
    ExpandedMembershipFee = Table.ExpandTableColumn(JoinedMembershipFee, "MembershipFeeData", {"Value"}, {"MembershipFeePerActive"}),
    FilledMembership = Table.ReplaceValue(ExpandedMembershipFee, null, 0, Replacer.ReplaceValue, {"MembershipFeePerActive"}),

    JoinedOtherFees = Table.NestedJoin(FilledMembership, {"Month"},
        Table.SelectRows(InterpolatedInputs, each [InputType] = "OtherFeesPerActive"), {"Month"},
        "OtherFeesData", JoinKind.LeftOuter),
    ExpandedOtherFees = Table.ExpandTableColumn(JoinedOtherFees, "OtherFeesData", {"Value"}, {"OtherFeesPerActive"}),
    FilledOtherFees = Table.ReplaceValue(ExpandedOtherFees, null, 0, Replacer.ReplaceValue, {"OtherFeesPerActive"}),

    JoinedSGA = Table.NestedJoin(FilledOtherFees, {"Month"},
        Table.SelectRows(InterpolatedInputs, each [InputType] = "PlatformSGA"), {"Month"},
        "SGAData", JoinKind.LeftOuter),
    ExpandedSGA = Table.ExpandTableColumn(JoinedSGA, "SGAData", {"Value"}, {"PlatformSGA"}),
    FilledSGA = Table.ReplaceValue(ExpandedSGA, null, 0, Replacer.ReplaceValue, {"PlatformSGA"}),

    // Bring DebitCardTransactionAmount as interchange base
    JoinedDebit = Table.NestedJoin(FilledSGA, {"Month", "ScenarioName"},
        Table.SelectColumns(OutflowsTable, {"Month", "ScenarioName", "DebitCardTransactionAmount"}), {"Month", "ScenarioName"},
        "DebitOut", JoinKind.LeftOuter),
    ExpandedDebit = Table.ExpandTableColumn(JoinedDebit, "DebitOut", {"DebitCardTransactionAmount"}, {"DebitCardTransactionAmount"}),

    // Calculations
    AddedMembershipRevenue = Table.AddColumn(ExpandedDebit, "MembershipRevenue", each
        [Active_Accounts] * [MembershipFeePerActive]
    ),
    AddedOtherFeeRevenue = Table.AddColumn(AddedMembershipRevenue, "OtherFeeRevenue", each
        [Active_Accounts] * [OtherFeesPerActive]
    ),
    AddedInterchangeRevenue = Table.AddColumn(AddedOtherFeeRevenue, "InterchangeRevenue", each
        [DebitCardTransactionAmount] * [PlatformInterchangeRate]
    ),
    AddedTotalRevenue = Table.AddColumn(AddedInterchangeRevenue, "TotalRevenue", each
        [MembershipRevenue] + [OtherFeeRevenue] + [InterchangeRevenue]
    ),

    AddedSGACost = Table.AddColumn(AddedTotalRevenue, "PlatformSGA_Cost", each
        [PlatformSGA]
    ),
    AddedContribution = Table.AddColumn(AddedSGACost, "PlatformContribution", each
        [TotalRevenue] - [PlatformSGA_Cost]
    ),

    ChangedTypes = Table.TransformColumnTypes(AddedContribution, {
        {"Month", Int64.Type},
        {"CheckingBalance", type number},
        {"SavingsBalance", type number},
        {"Monthly_Checking", type number},
        {"Monthly_Savings", type number},
        {"PlatformInterchangeRate", type number},
        {"MembershipFeePerActive", type number},
        {"OtherFeesPerActive", type number},
        {"PlatformSGA", type number},
        {"Active_Accounts", type number},
        {"DebitCardTransactionAmount", type number},
        {"MembershipRevenue", type number},
        {"OtherFeeRevenue", type number},
        {"InterchangeRevenue", type number},
        {"TotalRevenue", type number},
        {"PlatformSGA_Cost", type number},
        {"PlatformContribution", type number}
    })
in
    ChangedTypes

